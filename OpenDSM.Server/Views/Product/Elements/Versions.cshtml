@using OpenDSM.Core.Models
@model ProductModel
@{
    Layout = null;
    bool IsOwner = (bool)(ViewData["IsOwner"] ?? false);
    int product_id = Model.Id;
    string name = Model.Name;
}
<div class="list horizontal">
    <h2 style="width:100%">Versions</h2>
    @if (IsOwner)
    {
        <div id="upload-version" class="btn fa-solid fa-plus" title="Create new release" onclick="new CreateVersionPopup(@product_id).open()"></div>
    }
</div>
<div class="list vertical versions-list">
    @foreach (VersionModel version in Model.Versions.Values.Take(10))
    {
        <div class="version-item" id="@version.ID">
            <div class="list horizontal">
                <div class="list vertical">
                    <h4 class="name">@version.Name</h4>
                    <p class="paragraph-1" release-type="@version.Type.ToString().ToLower()" style="text-transform: capitalize">@version.Type.ToString()</p>
                    <p class="paragraph-3 downloads">@version.TotalDownloads.ToString("N0") Downloads</p>
                    <span class="platforms">
                        @foreach (var platform in version.Platforms)
                        {
                            string download_param = $"`{name}`,{product_id}, {version.ID}, '{platform.platform}', `{version.Name}`";
                            switch (platform.platform)
                            {
                                case OpenDSM.SQL.Platform.Windows:
                                    <i class="fab fa-windows" title="Windows" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                                case OpenDSM.SQL.Platform.WindowsARM:
                                    <i class="fab fa-windows" title="Windows ARM" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                                case OpenDSM.SQL.Platform.Mac:
                                    <i class="fab fa-apple" title="Mac" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                                case OpenDSM.SQL.Platform.MacARM:
                                    <i class="fab fa-apple" title="Mac ARM / Apple Silicon" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                                case OpenDSM.SQL.Platform.Linux:
                                    <i class="fab fa-linux" title="Linux" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                                case OpenDSM.SQL.Platform.LinuxARM:
                                    <i class="fab fa-linux" title="Linux ARM" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                                case OpenDSM.SQL.Platform.Java:
                                    <i class="fa-brands fa-java" title="Java" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                                case OpenDSM.SQL.Platform.Android:
                                    <i class="fa-brands fa-android" title="Java" onclick="new DownloadPopup(@download_param).open()"></i>
                                    break;
                            }
                        }
                    </span>

                </div>
                <div class="list vertical">
                    @if (IsOwner)
                    {
                        <button class="btn download" onclick="new EditVersionPopup(`@version.ID`, `@version.ProductID`, `@version.Name`, `@version.Changelog`, `@version.Type`).open()">Edit</button>
                        @if (!string.IsNullOrWhiteSpace(version.Changelog))
                        {
                            <button class="btn secondary changelog" onclick="new DeleteVersionPopup(`@version.ID`, `@version.ProductID`).open()">DELETE</button>
                        }
                    }
                    else
                    {
                        <a class="btn download" href="dsm://">Download</a>
                        @if (!string.IsNullOrWhiteSpace(version.Changelog))
                        {
                            <button class="btn secondary changelog" onclick="new ChangelogPopup(`@version.Type.ToString() - @version.Name`, `@version.Changelog`).open()">Changelog</button>
                        }
                    }
                </div>
            </div>
        </div>

    }

</div>

<section class="ad"></section>